<%= content_for :heading do %>
  <h1>
    <small>Positive Connections</small><br>
    People
  </h1>
<% end %>

<div class="row">
  <div class="col-sm-4">
    <%= search_form_for @search do |f| %>
      <div class="input-group">
        <%= f.text_field :name_cont, :class => "form-control" %>
        <span class="input-group-btn">
          <%= f.submit "Search", :class => "btn btn-primary" %>
        </span>
      </div><!-- /input-group -->
    <% end %>
  </div>
  <div class="col-sm-4 col-sm-offset-4">
    <%= link_to 'New Person', new_person_path, :class => "btn btn-primary pull-right" %>
  </div>
</div>

<hr>

<table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Companies</th>
      <th>Connect</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @people.order("name asc").each do |person| %>
      <tr>
        <td><%= person.name %></td>
        <td><%= raw person.companies.map {|c| link_to c.name, company_path(c)}.join(", ") %></td>
        <td>
          <% person.digital_addresses.order("address_type asc").each do |digi| %>
            <% if digi.address_type > 2 %>
              <%= link_to digi.url, :target => "_blank" do %>
                <div class="<%= digi.icon %>"></div>
              <% end %>
            <% elsif digi.address_type > 1 %>
              <%= link_to "mailto:#{digi.url}", :target => "_blank" do %>
                <div class="<%= digi.icon %>"></div>
              <% end %>
            <% else %>
              <%= link_to "tel:+#{digi.url}", :target => "_blank" do %>
                <div class="<%= digi.icon %>"></div>
              <% end %>
            <% end %>
          <% end %> 
        </td>
        <td>
          <div class="btn-group pull-right">
            <%= link_to 'Show', person, :class => "btn btn-default btn-sm" %>
            <%= link_to 'Edit', edit_person_path(person), :class => "btn btn-default btn-sm" %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
